function verify_code_unicity(a,b){return a.filter(function(a){return a.code===b.code&&a.id!==b.id}).length}function find_entity_index(a,b){var c=-1;return a.forEach(function(a,d){a.code===b.code&&(c=d)}),c}var config={urlserver:"http://localhost:8082/"},confman=angular.module("confman",["ngResource","ngRoute","ngMaterial","ui.bootstrap"]);confman.constant("constants",config),confman.config(["$routeProvider",function(a){a.when("/",{templateUrl:"view/main.html",controller:"MainCtrl"}).when("/application/:id",{templateUrl:"view/applicationdetail.html",controller:"applicationDetailCtrl"}).when("/config/search",{templateUrl:"view/configsearch.html",controller:"configSearchCtrl"}).when("/config/create",{templateUrl:"view/configcreate.html",controller:"configCreateCtrl"}).when("/config/compare",{templateUrl:"view/configcompare.html",controller:"configCompareCtrl"}).otherwise({redirectTo:"/"}),["environment","softwaresuite","application"].forEach(function(b){a.when("/"+b,{templateUrl:"view/"+b+".html",controller:b+"Ctrl"})})}]),confman.controller("AppCtrl",["$scope","$timeout","$materialSidenav","$http","constants",function(a,b,c,d,e){var f;b(function(){f=c("left")}),a.toggleLeft=function(){f.toggle()},a.close=function(){f.close()},a.isConfmanPageSelected=function(b){return a.currentPage&&b.filter(function(b){return a.currentPage.code===b?!0:void 0}).length>0?!0:!1},d.get(e.urlserver+"environment").success(function(){a.errorUrl=""}).error(function(){a.errorUrl="Impossible to dialog with confman server. Verify the server port in the config file [CONFMAN_PATH]/app/config.js"})}]),confman.run(["$rootScope",function(a){a.callbackOK=function(){a.error=null},a.callbackKO=function(b){a.error=b?{message:b.data,code:b.status}:{message:"server error",code:500}},a.setError=function(b,c){a.error={message:b,code:c}},a.getClassActionForm=function(a){return a.$invalid?"":"btn-primary"},a.setClassError=function(a){return a?"confman-line-error":""},a.isSelected=function(a,b){return a===b?"confman-selected":""}}]),angular.module("confman").controller("MainCtrl",["$rootScope",function(a){a.callbackOK(),a.currentPage={code:"home",name:"Welcome in Confman",actionbar:[]}}]),angular.module("confman").controller("environmentCtrl",["$rootScope","$scope","$modal","Environment",function(a,b,c,d){a.callbackOK(),a.currentPage={code:"env",name:"Environment",description:"You can use several environments to offer different context for developers, testers, the final users... For example you can have development, staging, production...",icon:"ic_settings_24px"},b.environments=d.query(),b.update=function(a){b.entity={verb:"Update environment",content:a,selected:a.id}},b.create=function(){b.entity={verb:"Create environment",content:{},selected:null}},b.delete=function(a,e){var f=c.open({templateUrl:"modalConfirmDelete.html",controller:function(a,b,c){a.entity_todelete=c,a.ok=function(){b.close(!0)},a.cancel=function(){b.dismiss(!1)}},resolve:{entity_todelete:function(){return"environment "+a.code}}});f.result.then(function(){e.stopPropagation(),d.delete(a,function(){b.error=null;var c=find_entity_index(b.environments,a);c>=0&&b.environments.splice(c,1),b.entity.content=null,b.entity.verb=null},b.callbackKO)})},b.save=function(c){return c.$error.required?void a.setError("Your form is not submitted : code and label are required"):verify_code_unicity(b.environments,b.entity.content)>0?void a.setError("The code ["+b.entity.content+"] is already in use"):void(b.entity.content.id?b.entity.content.$update(b.callbackOK,b.callbackKO):d.save(b.entity.content,function(a){b.error=null,b.environments||(b.environments={}),b.environments.push(a),b.entity.content=null,b.entity.verb=null},b.callbackKO))}}]),angular.module("confman").controller("softwaresuiteCtrl",["$rootScope","$scope","$http","$modal","SoftwareSuite","Environment","constants",function(a,b,c,d,e,f,g){a.callbackOK(),a.currentPage={code:"soft",name:"Software Suite",description:"In a complex context you have often a set of of software",icon:"ic_settings_24px"},b.softwaresuites=e.query(),b.update=function(d){b.entity={verb:"Update software suite",content:d,selected:d.id},b.hideEnv=!0,b.environments=f.query(function(){c.get(g.urlserver+"/softwaresuite/"+d.id+"/environment").success(function(a){a.forEach(function(a){for(var c=0;c<b.environments.length;c++){var d=b.environments[c];if(d.id===a.idEnvironmentDto){d.selected=!0;break}}}),b.hideEnv=!1}).error(function(){a.setError("Error on environments load ")})})},b.create=function(){b.entity={verb:"Create software suite",content:{}}},b.delete=function(a,c){var f=d.open({templateUrl:"modalConfirmDelete.html",controller:function(a,b,c){a.entity_todelete=c,a.ok=function(){b.close(!0)},a.cancel=function(){b.dismiss(!1)}},resolve:{entity_todelete:function(){return"software suite "+a.code}}});f.result.then(function(){c.stopPropagation(),e.delete(a,function(){b.error=null;var c=find_entity_index(b.softwaresuites,a);c>=0&&b.softwaresuites.splice(c,1),b.entity.content=null,b.entity.verb=null},b.callbackKO)})},b.save=function(c){if(c.$error.required)return void a.setError("Your form is not submitted : code and label are required");if(verify_code_unicity(b.softwaresuites,b.entity.content)>0)return void a.setError("The code ["+b.entity.content+"] is already in use");if(b.entity.content.id){var d=b.environments.filter(function(a){return a.selected});if(d){var f=[];d.forEach(function(a){f.push({idEnvironmentDto:a.id,codeEnvironmentDto:a.code,idSoftwareSuiteDto:b.entity.content.id,codeSoftwareSuiteDto:b.entity.content.code})}),b.entity.content.environments=f}b.entity.content.$update(b.callbackOK,b.callbackKO),b.entity.selected=b.entity.content.id}else e.save(b.entity.content,function(c){a.error=null,b.softwaresuites||(b.softwaresuites={}),b.softwaresuites.push(c),b.entity.content=c,b.entity.verb="Update software suite",b.entity.selected=c.id},b.callbackKO)}}]),angular.module("confman").controller("applicationCtrl",["$rootScope","$scope","$modal","$location","Application",function(a,b,c,d,e){a.callbackOK(),a.currentPage={code:"app",name:"Applications",description:"List of yours apps",icon:"ic_settings_24px"},b.applications=e.query(),b.update=function(a){d.path("/application/"+a.id)},b.create=function(){d.path("/application/0")}}]),angular.module("confman").controller("applicationDetailCtrl",["$rootScope","$scope","$modal","$routeParams","$filter","Application","Environment","SoftwareSuite","Instance","$location",function(a,b,c,d,e,f,g,h,i,j){a.currentPage={code:"app",name:"Application",description:d.id>0?"Update Application":"Create new application",icon:"ic_settings_24px",actionbar:[{icon:"ic_arrow_back_24px",action:function(){j.path("/application")}}]},b.softwaresuites=h.query(),b.environments=g.query(),b.parametertypes=["APPLICATION","INSTANCE"];var k=function(){b.instancesize=e("filter")(b.application.instances,{active:!0}).length,b.versionsize=e("filter")(b.application.versions,{active:!0}).length,b.paramsize=e("filter")(b.application.parameters,{active:!0}).length};d.id>0?f.get({id:d.id},function(a){angular.forEach(a.instances,function(a){angular.forEach(b.environments,function(b){a.idEnvironment===b.id&&(a.codeEnvironment=b.code)})}),b.application=a,k()}):b.application={},b.manageInstance=function(a){b.modalInstance=c.open({templateUrl:"modalAddInstanceToApplication.html",controller:function(a,b,c,e){a.error=null,a.environments=e,a.appelt={title:c.id?"Update instance":"Add instance",verb:c.id?"Update":"Add",icon:c.id?"ic_reply_all_24px.svg":"ic_add_24px.svg",content:c},a.ok=function(a){a.id||d(a),b.close(!1)},a.cancel=function(){b.dismiss(!1)}},resolve:{instance:function(){return a},environments:function(){return b.environments}}});var d=function(a){b.error=null,a.active=!0,b.application.instances||(b.application.instances=[]),angular.forEach(b.environments,function(b){a.idEnvironment===b.id&&(a.codeEnvironment=b.code)});var c=!1;angular.forEach(b.application.instances,function(b){a.code===b.code&&(b.code=a.code,b.label=a.label,b.idEnvironment=a.idEnvironment,b.active=!0,c=!0)}),c||b.application.instances.push(a),k()}},b.manageParameter=function(a){b.modalInstance=c.open({templateUrl:"modalAddParamToApplication.html",controller:function(a,b,c){a.error=null,a.parametertypes=["APPLICATION","INSTANCE"],a.appparam={title:c.id?"Update parameter":"Add parameter",verb:c.id?"Update":"Add",icon:c.id?"ic_reply_all_24px.svg":"ic_add_24px.svg",content:c},a.ok=function(a){a.id||d(a),b.close(!1)},a.cancel=function(){b.dismiss(!1)}},resolve:{parameter:function(){return a}}});var d=function(a){b.error=null,a.active=!0,b.application.parameters||(b.application.parameters=[]);var c=!1;angular.forEach(b.application.parameters,function(b){a.code===b.code&&(b.code=a.code,b.label=a.label,b.type=a.type,b.active=!0,c=!0)}),c||b.application.parameters.push(a),k()}},b.manageVersion=function(a){b.modalInstance=c.open({templateUrl:"modalAddVersionToApplication.html",controller:function(a,b,c){a.error=null,a.appelt={title:c.id?"Update version":"Add version",verb:c.id?"Update":"Add",icon:c.id?"ic_reply_all_24px.svg":"ic_add_24px.svg",content:c},a.ok=function(a){a.id||d(a),b.close(!1)},a.cancel=function(){b.dismiss(!1)}},resolve:{version:function(){return a}}});var d=function(a){b.error=null,a.active=!0,b.application.versions||(b.application.versions=[]);var c=!1;angular.forEach(b.application.versions,function(b){a.code===b.code&&(b.code=a.code,b.label=a.label,b.active=!0,c=!0)}),c||b.application.versions.push(a),k()}},b.save=function(){b.application.id?b.application.$update(function(c){b.application=c,a.error=null},b.callbackKO):f.save(b.application,function(c){b.application=c,a.error=null},b.callbackKO)},b.delete=function(a,d){var e=c.open({templateUrl:"modalConfirmDelete.html",controller:function(a,b,c){a.entity_todelete=c,a.ok=function(){b.close(!0)},a.cancel=function(){b.dismiss(!1)}},resolve:{entity_todelete:function(){return"application "+a.code}}});e.result.then(function(){d.stopPropagation(),f.delete(a,function(){j.path("/application")},b.callbackKO)})},b.cancel=function(){j.path("/application")};var l=function(a,b,c,d){var e=a.open({templateUrl:"modalConfirmDelete.html",controller:function(a,b,c){a.entity_todelete=c,a.ok=function(){k(),b.close(!0)},a.cancel=function(){b.dismiss(!1)}},resolve:{entity_todelete:function(){return c+" selected"}}});e.result.then(function(){d(b.filter(function(a){return!a.deleted}))})};b.deleteInstance=function(){l(c,b.application.instances,"instances",function(a){b.application.instances=a})},b.chgInstanceToDelete=function(){b.nbInstanceToDelete=0,b.application.instances.forEach(function(a){a.deleted&&b.nbInstanceToDelete++})},b.deleteVersion=function(){l(c,b.application.versions,"versions",function(a){b.application.versions=a})},b.chgVersionToDelete=function(){b.nbVersionToDelete=0,b.application.versions.forEach(function(a){a.deleted&&b.nbVersionToDelete++})},b.deleteParameter=function(){l(c,b.application.parameters,"parameters",function(a){b.application.parameters=a})},b.chgParameterToDelete=function(){b.nbParameterToDelete=0,b.application.parameters.forEach(function(a){a.deleted&&b.nbParameterToDelete++})}}]),angular.module("confman").controller("configCompareCtrl",["$rootScope","$scope","$http","constants","Application","Params",function(a,b,c,d,e,f){a.callbackOK(),a.currentPage={code:"confcomp",name:"Configurations",description:"Compare two configurations",icon:"ic_settings_24px"},b.applications=e.query(),b.applicationVersions=[],b.environments=[],b.criteria={},b.changeApplication=function(){b.applicationVersions=[],b.environments=[],b.criteria.idApplication>0&&(f.getTrackingVersionByIdApp(b.criteria.idApplication,function(a){b.applicationVersions=a}),f.getEnvByIdApp(b.criteria.idApplication,function(a){b.environments=a}))},b.compareVersion=function(){f.compareVersion(b,{idEnvironment:b.criteria.idEnvironment1,idTrackingVersion:b.criteria.idApplicationVersion1},{idEnvironment:b.criteria.idEnvironment2,idTrackingVersion:b.criteria.idApplicationVersion2},function(a){b.listecomp=a})}}]),angular.module("confman").controller("configCreateCtrl",["$rootScope","$scope","$http","$modal","constants","Application","Params",function(a,b,c,d,e,f,g){a.callbackOK(),a.currentPage={code:"confcreate",name:"Configurations",description:"Create new configuration",icon:"ic_satellite_24px"},b.criteria={},b.applications=f.query(),b.envSelected={},b.changeApplication=function(){b.applicationVersions=[],b.environments=[],b.criteria.idApplication>0&&(g.getAppVersionByIdApp(b.criteria.idApplication,function(a){b.applicationVersions=a}),g.getEnvByIdApp(b.criteria.idApplication,function(a){b.environments=a,b.selectedIndex=0}))},b.createParametersValues=function(){d.open({templateUrl:"modalConfirmCreation.html",controller:["$scope","$modalInstance",function(a,b){a.icon="ic_add_24px.svg",a.cancel=function(){b.dismiss(!1)},a.ok=function(){f(),b.close(!0)}}]});var f=function(){b.criteria.idApplicationVersion>0?c.post(e.urlserver+"/parametervalue",b.criteria.idApplicationVersion).success(function(c){b.parameters=c,b.parameters.length>0&&(b.versionTrackiCode=b.parameters[0].codeTrackingVersion,b.versionTrackiId=b.parameters[0].idTrackingVersion,b.environments.length>0?b.onTabSelected(b.environments[0],0):b.envparameters=b.parameters),a.callbackOK()}).error(function(){b.parameters=[],a.setError("An error occured")}):b.parameters=[]}},b.saveParametersValues=function(){d.open({templateUrl:"modalConfirmCreation.html",controller:["$scope","$modalInstance",function(a,b){a.icon="ic_save_24px.svg",a.cancel=function(){b.dismiss(!1)},a.ok=function(){f(),b.close(!0)}}]});var f=function(){c.put(e.urlserver+"/parametervalue",b.parameters).success(function(){a.callbackOK(),b.lockVersion=!0,c.post(e.urlserver+"/parametervalue/search",{nbEltPerPage:99999,idTrackingVersion:b.versionTrackiId}).success(function(a){b.parameters=a.list,b.onTabSelected(b.environments[0],0),b.callbackOK()}).error(function(){a.setError("An error occured when we search the changes in database")})}).error(function(){a.setError("An error occured on saving changes")})}},b.onTabSelected=function(a,c){b.envSelected=a,b.parameters&&(c&&(b.selectedIndex=c),b.envparameters=b.parameters.filter(function(b){return b.codeEnvironment===a.code?!0:void 0}))},b.classTabSelected=function(a){return b.envSelected.code===a.code?"active confman-tab-pane":""}}]),angular.module("confman").controller("configSearchCtrl",["$rootScope","$scope","$http","constants","Environment","TableService","Params",function(a,b,c,d,e,f,g){a.callbackOK(),a.currentPage={code:"confsearch",name:"Configurations",description:"Search configuration and wath parameters values",icon:"ic_satellite_24px"},b.environments=e.query(),b.parametervalues=[],b.criteria={},b.page=1,b.changeApplication=function(){b.instances=[],b.trackingVersions=[],b.criteria.idApplication>0&&(g.getInstanceByIdAppAndIdEnv(b.criteria.idApplication,b.criteria.idEnvironment,function(a){b.instances=a}),g.getTrackingVersionByIdApp(b.criteria.idApplication,function(a){b.trackingVersions=a}))},b.changeEnvironment=function(){b.criteria.idEnvironment>0?g.getAppByIdEnv(b.criteria.idEnvironment,function(a){b.applications=a}):(b.applications=[],b.instances=[],b.trackingVersions=[])},b.reset=function(){b.criteria={},b.applications=[],b.instances=[],b.trackingVersions=[]},b.pageActive=function(a){return b.page===a?"active":void 0},b.filter=function(a){var c={page:a};b.criteria.idApplication>0&&(c.idApplication=b.criteria.idApplication),b.criteria.idInstance>0&&(c.idInstance=b.criteria.idInstance),b.criteria.idTrackingVersion>0&&(c.idTrackingVersion=b.criteria.idTrackingVersion),b.criteria.idEnvironment>0&&(c.idEnvironment=b.criteria.idEnvironment),b.criteria.code&&(c.code=b.criteria.code),g.getParamValueByCriteria(c,function(a){b.parametervalues=a,b.page=a.currentPage,b.nbPageTotal=f.getNumMaxPage(a.completeSize,a.nbElementByPage),b.pageSelector=b.nbPageTotal>1?f.getPageSelector(a.currentPage,b.nbPageTotal):null,b.pageSelectorNext=b.pageSelector?b.pageSelector[b.pageSelector.length-1]:0,b.callbackOK()},b.callbackKO)}}]);var restActions={get:{method:"GET"},save:{method:"POST"},update:{method:"PUT"},query:{method:"GET",isArray:!0},"delete":{method:"DELETE"}};angular.module("confman").factory("Environment",["$resource","constants",function(a,b){return a(b.urlserver+"environment/:id",{id:"@_id"},restActions)}]).factory("SoftwareSuite",["$resource","constants",function(a,b){return a(b.urlserver+"softwaresuite/:id",{id:"@_id"},restActions)}]).factory("Application",["$resource","constants",function(a,b){return a(b.urlserver+"application/:id",{id:"@_id"},restActions)}]).factory("ApplicationVersion",["$resource","constants",function(a,b){return a(b.urlserver+"applicationversion/:id",{id:"@_id"},restActions)}]).factory("TrackingVersion",["$resource","constants",function(a,b){return a(b.urlserver+"trackingversion/:id",{id:"@_id"},restActions)}]).factory("Instance",["$resource","constants",function(a,b){return a(b.urlserver+"instance/:id",{id:"@_id"},restActions)}]).factory("Parameter",["$resource","constants",function(a,b){return a(b.urlserver+"parameter/:id",{id:"@_id"},restActions)}]).factory("ParamaterGroupment",["$resource","constants",function(a,b){return a(b.urlserver+"parametergroupment/:id",{id:"@_id"},restActions)}]),angular.module("confman").factory("TableService",[function(){return{getNumMaxPage:function(a,b){if(a&&b>0){var c=parseInt(a/b);return a%b===0?c:c+1}return 0},getPageSelector:function(a,b){var c=1,d=b,e=b;a>6&&b>=10&&(e=10,b-a>=4?(c=a-5,d=a+4):c=b-9);for(var f=[],g=c,h=0;d>=g&&10>h;g++,h++)f.push(g);return f}}}]),angular.module("confman").factory("Params",["$http","constants",function(a,b){return{getTrackingVersionByIdApp:function(c,d){a.get(b.urlserver+"trackingversion/application/"+c).success(d)},getAppVersionByIdApp:function(c,d){a.get(b.urlserver+"applicationversion/application/"+c).success(d)},getAppByIdEnv:function(c,d){a.get(b.urlserver+"application/environment/"+c).success(d)},getEnvByIdApp:function(c,d){a.get(b.urlserver+"environment/application/"+c).success(d)},getInstanceByIdAppAndIdEnv:function(c,d,e){a.get(b.urlserver+"instance/application/"+c+"/environment/"+d).success(e)},getParamValueByCriteria:function(c,d,e){a.post(b.urlserver+"parametervalue/search",c).success(d).error(e)},compareVersion:function(c,d,e,f){d.page=1,d.nbEltPerPage=99999,e.page=1,e.nbEltPerPage=99999,a.post(b.urlserver+"parametervalue/search",d).success(function(d){c.liste1=d.list,a.post(b.urlserver+"parametervalue/search",e).success(function(a){var b=[];c.liste2=a.list;c.liste1.forEach(function(a){var d=c.liste2.filter(function(b){return b.code===a.code}),e=d.length>0;b.push({elt1:a,elt2:e?d[0]:{},codeInstance:e?d[0].codeInstance:a.codeInstance,code:e?d[0].code:a.code,difference:!e})}),c.liste2.forEach(function(a){0==c.liste1.filter(function(b){return a.code===b.code}).length&&b.push({elt1:{},elt2:a,codeInstance:a.codeInstance,code:a.code,difference:!0})}),f(b)})})}}}]),angular.module("confman").directive("semverChecker",["$http","constants",function(a,b){return{require:"ngModel",restrict:"A",link:function(c,d,e,f){f.$parsers.push(function(c){return a.get(b.urlserver+"/applicationversion/check/"+c).success(function(a){f.$setValidity("semver","true"===a)}),c})}}}]);